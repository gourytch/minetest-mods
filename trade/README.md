TRADE - обмен между игроками
============================

команды
=======

/trade help -- подсказка по командам системы обмена
/trade showdesk -- показывает форму с main- и trade- списками инвентаря игрока 
               (чтобы забрать/выложить вещи)
/trade with ник -- предлагает обмен игроку 
/trade disable -- блокирует все предложения обмена
/trade block [ник] [заметка] -- добавляет игрока в личный блоклист
/trade enable -- снимает блокировку с предложений обмена
/trade unblock [ник] -- убирает игрока из личного блоклиста
/trade blocklist -- выдаёт список личных блокировок
/trade status -- выдаёт состояние системы обмена
/trade statistic -- выдаёт статистику системы обмена

идеи и полуформальное описание обмена:
======================================

* у игроков в инвентаре заводим отдельные списки trade
* игрок name1 посылает команду /trade name2
* проверяется, есть ли игроков name1 и name2 возможность торговли
* (есть соответствующие права, не мёртвые ли, нет ли выставленного запрета
  на приём торговли и т.п.)
* у игрока name2 открывается диалоговое окно "игрок name1 предлагает обмен"
  с кнопками "согласиться", "отказаться", "блокировать" и таймер обратного отсчёта
  * при отказе или истечении таймера окно закрывается. конец.
  * при нажатии на "блокировать" окно закрывается, player1 добавляется в ignore-лист у player2. конец.
  * при нажатии на "согласиться" окно закрывается
  * начинается сеанс обмена
  * заводятся флаги accepted у player1 и player2 (сброшены изначально)
  * у player1 открывается форма, где в trade-части слева отображается trade-список инвентаря player1
    а справа read-only trade-список инвентаря player2; кнопка, переключающая accepted-флаг player1,
    main-инвентарь player1
  * у player2 открывается форма, где в trade-части слева отображается trade-список инвентаря player2
    а справа read-only trade-список инвентаря player1; кнопка, переключающая accepted-флаг player2,
    main-инвентарь player2
  * при любом премещении вещей в своей trade-части флаги accepted у player1 и player2 сбрасываются
  * при нажатии игроком кнопки подтверждения взводится флаг accepted (player1 или player2 соответственно)
  * если оба флага accepted взведены, то 
    информация о сделке регистрируется в общем списке и историях игроков
    происходит обмен (swap) содержимым trade-списков player1 и player2
    флаги accepted сбрасываются, формы переключаются на showdesk-ную, конец
  * если при периодической проверке обнаруживается, что торговля невозможна,
    то формы торговли у player1 и player2 закрываются, формы переключаются на showdesk-ную, конец.
    
формы:
======

form_request:
 "игрок nickname предлагает вам обмен"
 [согласиться][отказаться][блокировать]

form_showdesk:
 [3x3] - trade-список
 [забрать всё] - кнопка, перемещающая всё содержимое trade в main (если может)
 [8x4] - main-список

form_trade
   [3x3]     [3x3] - списки обмена
 [accept1] [accept2] -- картинки подтверждения
 [подтвердить обмен] -- кнопка подтверждения обмена. при нажатии accept меняется
 [8x4] - main-список
левый trade-инвентарь - интерактивен, правый - readonly

--]]